<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DigiByte Support</title>
	<link href="style.css" rel="stylesheet">
</head>
<body>
	<div id="window">
        <div id="main">
            <div id="answer">Loading</div>
            <div id="question"></div>
            <div id="options"></div>
        </div>
	</div>
    <div id="warn" class="shadow">
        <div id="warnText"></div>
        <input id="warnConfirm" type="text">
    </div>
    <div id="shadow" class="shadow"></div>
    <script
            src="https://code.jquery.com/jquery-2.1.4.min.js"
            integrity="sha256-8WqyJLuWKRBVhxXIL1jBDD7SDxU936oZkCnxQbWwJVw="
            crossorigin="anonymous"></script>
    <script>
        let answers={};
        let warnAnswer;


        let getPage=(key)=>{
            //load page
            let page=answers[key]||answers["done_no_help"];//find page.  If missing fall back to couldn't help
            $("#answer").html(page.answer||"");
            $("#question").html(page.question||"");
            let html="";
            for (let key in page.options) {
                html+='<button class="option" key="'+key+'">'+page.options[key]+'</button>';
            }
            $("#options").html(html);
            if (page.warn!==undefined) {
                $("#warnText").html(page.warn.challenge);
                warnAnswer=page.warn.answer;
                $(".shadow").show();
            }

            //add the page to url
            let url=window.location.href;
            let last=url;
            let end=url.indexOf('#');
            if (end>0) url = url.substr(0,end); //remove everything after and including # if present
            url+="#"+key;
            console.log(url);
            if (url!==last) window.location.replace(url);
        }

        //handle option click
        $(document).on('click','.option',function(){
            let key=$(this).attr('key');
            getPage(key);
        });

        $(document).on('keyup',"#warnConfirm",function(){
            if ($("#warnConfirm").val().toLowerCase()===warnAnswer.toLowerCase()) {
                $(".shadow").hide();
            }
        });

        //load data and start
        $.getJSON('answers-en.json').then((data)=>{
            //save answers
            answers=data;

            //find what page to load
            let url=window.location.href;
            let end=url.indexOf('#');
            let key="start";
            if (end>0) key = url.substr(end + 1);
            if (answers[key]===undefined) key=start;      //if page doesn't exist go to start

            //load page
            getPage(key);
        });
    </script>
        <img id="dgb-d" src="DGB.svg" alt="" width="45px">
        <h2 id="troubleshooting">Troubleshooting</h3>
</body>
</html>