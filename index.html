<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DigiByte Support</title>
	<link href="style.css" rel="stylesheet">
</head>
<body>
    <div id="language_div">
        <label for="language">Language:</label>
        <select id="language">
            <option value="en">English</option>
            <option value="sv">Swedish</option>
        </select>
    </div>
    <div id="overlay"></div>
	<div id="window">
        <div id="main">
            <div id="answer">Loading</div>
            <div id="question"></div>
            <div id="options"></div>
        </div>
	</div>
    <div id="warn" class="shadow">
        <div id="warnText"></div>
        <input id="warnConfirm" type="text">
    </div>
    <div id="shadow" class="shadow"></div>
    <img id="dgb-d" src="img/dgb.svg" alt="" width="45px">
    <h2 id="troubleshooting">Troubleshooting</h2>
    <script
            src="https://code.jquery.com/jquery-2.1.4.min.js"
            integrity="sha256-8WqyJLuWKRBVhxXIL1jBDD7SDxU936oZkCnxQbWwJVw="
            crossorigin="anonymous"></script>
    <script>
        let answers={};
        let language='en';
        let warnAnswer;


        let getPage=(key)=>{
            //load page
            let page=answers[language][key]||answers.en[key]||answers[language]["done_no_help"];//find page.  If missing fall back to english then couldn't help
            $("#answer").html(page.answer||"");
            $("#question").html(page.question||"");
            let html="";
            for (let key in page.options) {
                html+='<button class="option" key="'+key+'">'+page.options[key]+'</button>';
            }
            $("#options").html(html);
            if (page.warn!==undefined) {
                $("#warnText").html(page.warn.challenge);
                warnAnswer=page.warn.answer;
                $(".shadow").show();
            }

            //add the page to url
            let url=window.location.href;
            let last=url;
            let end=url.indexOf('#');
            if (end>0) url = url.substr(0,end); //remove everything after and including # if present
            url+="#"+key;
            console.log(url);
            if (url!==last) window.location.replace(url);
        }

        //handle option click
        $(document).on('click','.option',function(){
            let key=$(this).attr('key');
            $("#window").fadeOut(100,() => {
                getPage(key);
                $("#window").fadeIn(300, () => $("#window").animate({scrollTop:0}, "smooth"));
            });
        });

        $(document).on('keyup',"#warnConfirm",function(){
            if ($("#warnConfirm").val().toLowerCase()===warnAnswer.toLowerCase()) {
                $(".shadow").hide();
            }
        });

        //function to find current key
        let getKey=()=>{
            //find what page to load
            let url=window.location.href;
            let end=url.indexOf('#');
            let key="start";
            if (end>0) key = url.substr(end + 1);
            if (answers.en[key]===undefined) key=start;      //if page doesn't exist go to start
            return key;
        }

        //load data and start
        $.getJSON('answers-en.json').then((data)=>{
            //save answers
            answers.en=data;

            //load page
            getPage(getKey());
        });

        //handle language change
        $("#language").on('change',()=>{
            language=$("#language").val();
            if (answer[language]===undefined) {
                $.getJSON('answers-'+language+'.json').then((data)=>{
                    //save answers
                    answers[language]=data;

                    //load page
                    getPage(getKey());
                });
            }
        });

        //show window
        $(document).ready(()=>$("#window").fadeIn(300));
    </script>
</body>
</html>